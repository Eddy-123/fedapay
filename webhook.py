from .webhook_signature import WebhookSignature

class Webhook:
    def __init__(self):
        self.default_tolerance = 300
    
    def construct_event(self, payload, signature_header, secret, tolerance=None):
        if tolerance is None:
            tolerance = self.default_tolerance
        
        WebhookSignature().verify_header(payload, signature_header, secret, tolerance)
    

payload = b'{"name":"transaction.transferred","object":"transaction","entity":{"klass":"v1/transaction","id":230390,"reference":"trx_Cao_1706378631081","amount":2000,"description":"vehicle_total_penalties_amount 8","callback_url":"https://sandbox-checkout.fedapay.com/transactions/callback?secured_id=\\u0026secured_id=secured_id_etdbbkw58","status":"transferred","customer_id":18622,"currency_id":1,"mode":"moov","operation":"payment","metadata":{"paid_customer":{"firstname":"Alexandrea","lastname":"Keebler","email":"lixoga1490@gosarlar.com"},"transfer_schedule_jobid":"b417f5345c8894169a937424"},"commission":"0.018","fees":37,"fixed_commission":0,"amount_transferred":2000,"created_at":"2024-01-27T18:03:51.080Z","updated_at":"2024-01-30T18:07:32.071Z","approved_at":"2024-01-27T18:05:28.963Z","canceled_at":null,"declined_at":null,"refunded_at":null,"transferred_at":"2024-01-30T18:07:31.998Z","deleted_at":null,"last_error_code":"API_ERROR","custom_metadata":null,"amount_debited":2037,"receipt_url":"https://sandbox-api.fedapay.com/v1/transactions/receipt?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjIzMDM5MCwiZXhwIjoxNzA2NDY1MTI5fQ.6Y6ZkDYUWotDttLSiEPz0gdHo2eYt0jhM7Kcj1Gu4fs","payment_method_id":67643,"sub_accounts_commissions":null,"transaction_key":"1789267781842281","merchant_reference":null,"account_id":8202,"balance_id":142430,"customer":{"klass":"v1/customer","id":18622,"firstname":"Unknown","lastname":"Unknown","full_name":"Unknown Unknown","email":null,"account_id":8202,"created_at":"2024-01-27T18:03:51.075Z","updated_at":"2024-01-27T18:03:51.075Z","deleted_at":null},"currency":{"klass":"v1/currency","id":1,"name":"FCFA","iso":"XOF","code":952,"prefix":null,"suffix":"CFA","div":1,"default":true,"created_at":"2018-05-27T21:26:23.618Z","updated_at":"2023-04-25T13:45:49.805Z","modes":["mtn","cybersource","moov","mtn_ci","moov_tg","orange_ci","orange_sn","free_sn","airtel_ne","togocel","orange_ml","mtn_open","mtn_ecw","ecobank_tpe","orabank_tpe","uba","stripe_gw","uba_atm","bmo","mtn_open_ci","sbin"]},"payment_method":{"klass":"v1/payment_method","id":67643,"brand":"moov","country":"BJ","number":"22964000001","deleted_at":null,"created_at":"2024-01-27T18:05:28.529Z","updated_at":"2024-01-27T18:05:28.529Z","method":"phone"},"balance":{"klass":"v1/balance","id":142430,"amount":22000,"mode":"moov","created_at":"2024-01-27T17:22:46.921Z","updated_at":"2024-01-27T17:22:46.921Z"},"refunds":[]},"account":{"klass":"v1/account","id":8202,"name":"Mon compte","timezone":"UTC","country":"BJ","created_at":"2024-01-27T17:22:46.777Z","updated_at":"2024-01-30T17:46:50.965Z","verified":false,"reference":"acc_4888146135","business_type":null,"business_identity_type":null,"business_identity_number":null,"business_vat_number":null,"business_registration_number":null,"business_category":null,"blocked":false,"business_website":null,"business_address":null,"business_name":null,"business_phone":null,"business_email":null,"business_owner":null,"business_company_capital":null,"business_description":null,"submitted":false,"reject_reason":null,"has_balance_issue":false,"last_balance_issue_checked_at":"2024-01-30T17:46:50.957Z","prospect_code":null,"deal_closer_code":null,"manager_code":null,"business_identity_id":null,"business_vat_id":null,"business_registration_id":null,"business_owner_signature_id":null,"business_identity":null,"business_vat":null,"business_registration":null,"business_owner_signature":null,"user_accounts":[{"klass":"v1/user_account","id":8237,"account_id":8202,"user_id":7881,"role_id":1}],"users":[{"klass":"v1/user","id":7881,"email":"lixoga1490@gosarlar.com","confirmed_at":"2024-01-27T17:24:34.268Z","reset_sent_at":null,"admin":false,"admin_role":"user","created_at":"2024-01-27T17:22:46.755Z","updated_at":"2024-01-27T17:24:34.277Z","firstname":"Eddy","lastname":"Adegnandjou","locale":"fr","two_fa_enabled":false}],"api_keys":[{"klass":"v1/api_key","id":8807,"created_at":"2024-01-27T17:22:47.681Z","updated_at":"2024-01-27T17:22:47.681Z","public_key":"pk_sandbox_NVGMAJZFlVlhg2rU5YzgI2xY"}],"balances":[{"klass":"v1/balance","id":142444,"amount":0,"mode":"sbin","created_at":"2024-01-27T17:22:47.668Z","updated_at":"2024-01-27T17:22:47.668Z"},{"klass":"v1/balance","id":142443,"amount":0,"mode":"bmo","created_at":"2024-01-27T17:22:47.599Z","updated_at":"2024-01-27T17:22:47.599Z"},{"klass":"v1/balance","id":142442,"amount":0,"mode":"uba_atm","created_at":"2024-01-27T17:22:47.559Z","updated_at":"2024-01-27T17:22:47.559Z"},{"klass":"v1/balance","id":142441,"amount":0,"mode":"uba","created_at":"2024-01-27T17:22:47.478Z","updated_at":"2024-01-27T17:22:47.478Z"},{"klass":"v1/balance","id":142440,"amount":0,"mode":"orabank_tpe","created_at":"2024-01-27T17:22:47.435Z","updated_at":"2024-01-27T17:22:47.435Z"},{"klass":"v1/balance","id":142439,"amount":0,"mode":"ecobank_tpe","created_at":"2024-01-27T17:22:47.395Z","updated_at":"2024-01-27T17:22:47.395Z"},{"klass":"v1/balance","id":142438,"amount":0,"mode":"orange_ml","created_at":"2024-01-27T17:22:47.320Z","updated_at":"2024-01-27T17:22:47.320Z"},{"klass":"v1/balance","id":142437,"amount":0,"mode":"togocel","created_at":"2024-01-27T17:22:47.277Z","updated_at":"2024-01-27T17:22:47.277Z"},{"klass":"v1/balance","id":142436,"amount":0,"mode":"airtel_ne","created_at":"2024-01-27T17:22:47.237Z","updated_at":"2024-01-27T17:22:47.237Z"},{"klass":"v1/balance","id":142435,"amount":0,"mode":"free_sn","created_at":"2024-01-27T17:22:47.198Z","updated_at":"2024-01-27T17:22:47.198Z"},{"klass":"v1/balance","id":142434,"amount":0,"mode":"orange_sn","created_at":"2024-01-27T17:22:47.160Z","updated_at":"2024-01-27T17:22:47.160Z"},{"klass":"v1/balance","id":142433,"amount":0,"mode":"orange_ci","created_at":"2024-01-27T17:22:47.120Z","updated_at":"2024-01-27T17:22:47.120Z"},{"klass":"v1/balance","id":142432,"amount":0,"mode":"moov_tg","created_at":"2024-01-27T17:22:47.079Z","updated_at":"2024-01-27T17:22:47.079Z"},{"klass":"v1/balance","id":142431,"amount":0,"mode":"mtn_ci","created_at":"2024-01-27T17:22:46.960Z","updated_at":"2024-01-27T17:22:46.960Z"},{"klass":"v1/balance","id":142430,"amount":22000,"mode":"moov","created_at":"2024-01-27T17:22:46.921Z","updated_at":"2024-01-27T17:22:46.921Z"},{"klass":"v1/balance","id":142429,"amount":0,"mode":"stripe_gw","created_at":"2024-01-27T17:22:46.884Z","updated_at":"2024-01-27T17:22:46.884Z"},{"klass":"v1/balance","id":142428,"amount":0,"mode":"mtn","created_at":"2024-01-27T17:22:46.847Z","updated_at":"2024-01-27T17:22:46.847Z"}],"bank_accounts":[],"mobile_accounts":[],"card_accounts":[],"currencies":[{"klass":"v1/currency","id":1,"name":"FCFA","iso":"XOF","code":952,"prefix":null,"suffix":"CFA","div":1,"default":true,"created_at":"2018-05-27T21:26:23.618Z","updated_at":"2023-04-25T13:45:49.805Z","modes":["mtn","cybersource","moov","mtn_ci","moov_tg","orange_ci","orange_sn","free_sn","airtel_ne","togocel","orange_ml","mtn_open","mtn_ecw","ecobank_tpe","orabank_tpe","uba","stripe_gw","uba_atm","bmo","mtn_open_ci","sbin"]}]}}'
Webhook().construct_event(
    payload=payload, 
    signature_header='t=1706646266,s=f33b260296251577fea0ee8d03a5a7867c63f74f635d688f13eeea428501e824', 
    secret='wh_sandbox_3tzRiyUcHVyEXG4dY7b6TnxZ', 
    tolerance=300)